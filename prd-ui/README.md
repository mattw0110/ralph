# Ralph PRD UI

A full-stack web application for creating Product Requirements Documents (PRDs) and converting them to Ralph's JSON format.

## Features

- **PRD Creation Wizard**: Guided multi-step process to create PRDs
  - Uses Cursor CLI agent (if available) for intelligent PRD generation
  - Falls back to template-based generation if agent is unavailable
- **PRD to JSON Conversion**: Convert markdown PRDs to Ralph's `prd.json` format
  - Uses Cursor CLI agent (if available) for intelligent conversion
  - Falls back to template-based conversion if agent is unavailable
- **Project Management**: Point to any project directory to manage PRDs
- **Real-time Preview**: See PRD markdown and JSON previews as you work
- **Folder Selection**: Browse and select project folders (with manual path entry fallback)

## Prerequisites

- Node.js 18+ 
- pnpm (package manager)
- [Cursor CLI](https://cursor.com/docs/cli) installed and authenticated (optional but recommended)
  - The UI uses Cursor CLI agent for enhanced PRD generation and JSON conversion
  - If Cursor CLI is not available, the UI falls back to template-based generation
  - Install: Follow instructions at https://cursor.com/docs/cli

## Setup

### Install Dependencies

From the root directory:

```bash
pnpm install
```

This will install dependencies for both backend and frontend.

### Environment Variables

Copy the example environment file:

```bash
cp backend/.env.example backend/.env
```

Edit `backend/.env` if needed (defaults should work for local development).

## Development

### Run Backend

```bash
cd backend
pnpm run dev
```

Backend runs on `http://localhost:3001` using nodemon for hot reload.

### Run Frontend

```bash
cd frontend
pnpm run dev
```

Frontend runs on `http://localhost:5173`

### Run Both (from root)

```bash
pnpm run dev
```

This runs both backend and frontend in parallel.

## Testing

### Run All Tests

```bash
pnpm test
```

### Run Frontend Tests

```bash
pnpm test:frontend
# or
cd frontend && pnpm test
```

### Run Backend Tests

```bash
pnpm test:backend
# or
cd backend && pnpm test
```

### Test Coverage

```bash
pnpm test:coverage
```

### Frontend Test UI

```bash
cd frontend
pnpm test:ui
```

Opens Vitest UI for interactive test running.

## Usage

1. **Start the application**: Run both backend and frontend servers
   ```bash
   pnpm run dev
   ```

2. **Open browser**: Navigate to `http://localhost:5173`

3. **Create PRD**: 
   - Click "Create PRD"
   - Select your project directory (or enter path manually)
   - Enter your feature description
   - Answer clarifying questions (generated by Cursor CLI agent if available)
   - Review and edit the generated PRD
   - Save the PRD to your project's `tasks/` directory

4. **Convert to JSON**:
   - Click "Convert to JSON"
   - Select your project directory
   - Choose an existing PRD file or paste PRD content
   - Review the generated JSON (converted by Cursor CLI agent if available)
   - Save `prd.json` to your project root

**Note**: If Cursor CLI agent is available, it will be used for enhanced PRD generation and JSON conversion. The UI automatically falls back to template-based methods if the agent is unavailable or fails.

## Project Structure

```
prd-ui/
├── backend/          # Express API server
│   ├── routes/       # API route handlers
│   ├── services/     # Business logic
│   └── utils/        # Utility functions
├── frontend/         # React + Vite frontend
│   └── src/
│       ├── components/  # React components
│       ├── hooks/       # Custom React hooks
│       ├── services/    # API client
│       ├── types/       # TypeScript types
│       └── test/        # Test setup
└── README.md
```

## API Endpoints

### Project
- `POST /api/project/validate` - Validate project path
- `GET /api/project/prds` - List PRD files

### PRD
- `POST /api/prd/generate-questions` - Generate clarifying questions
- `POST /api/prd/create` - Create PRD file
- `GET /api/prd/read` - Read existing PRD
- `PUT /api/prd/update` - Update PRD

### Convert
- `POST /api/convert` - Convert PRD to JSON
- `POST /api/convert/save` - Save prd.json

## Cursor CLI Integration

The PRD UI integrates with Cursor CLI agent to provide enhanced PRD generation and JSON conversion capabilities.

### How It Works

1. **PRD Generation**: When creating a PRD, the UI uses Cursor CLI agent to:
   - Generate intelligent clarifying questions based on your feature description
   - Create a detailed PRD with proper structure and formatting
   - Uses `agent --print --force` flags to enable shell execution

2. **JSON Conversion**: When converting PRD to JSON, the UI uses Cursor CLI agent to:
   - Intelligently parse the PRD markdown
   - Extract user stories, acceptance criteria, and metadata
   - Generate properly formatted `prd.json` for Ralph

3. **Fallback Behavior**: If Cursor CLI agent is unavailable or fails:
   - The UI automatically falls back to template-based generation
   - All core functionality remains available
   - No user action required

### Requirements

- Cursor CLI must be installed and in your PATH
- Cursor CLI must be authenticated (`agent status` should work)
- The `agent` command uses `--print --force` flags for shell execution

### Verification

To verify Cursor CLI is working:
```bash
agent --version  # Should show version number
agent status     # Should show authentication status
```

## Building for Production

```bash
cd frontend
pnpm run build
```

Built files will be in `frontend/dist/`

## Security Notes

- All file paths are validated to prevent directory traversal attacks
- File operations are restricted to specified project directories
- Input validation is performed on all user inputs

## Troubleshooting

**Backend won't start / Port already in use:**
- If you see `EADDRINUSE: address already in use :::3001`:
  ```bash
  cd backend
  pnpm run kill-port  # Kills process on port 3001
  # Or manually: lsof -ti:3001 | xargs kill -9
  ```
- Or change the port in `backend/.env`: `PORT=3002`
- Verify Node.js version is 18+

**Frontend won't start:**
- Check that port 5173 is not in use
- Clear `node_modules` and reinstall: `pnpm install`

**API calls fail:**
- Ensure backend is running on port 3001
- Check CORS settings in `backend/server.js`
- Verify backend server started successfully (check console for errors)

**Cursor CLI agent not working:**
- Verify Cursor CLI is installed: `agent --version`
- Ensure Cursor CLI is authenticated: `agent status`
- The UI will automatically fall back to template-based generation if agent is unavailable
- Check that `agent` command is in your PATH
- Agent commands use `--print --force` flags to enable shell execution

**PRD generation or conversion fails:**
- If using Cursor CLI agent, check that it's properly configured
- The UI will automatically fall back to template-based methods if agent fails
- Check backend console logs for detailed error messages
- Ensure the project path is valid and accessible

**Tests fail:**
- Run `pnpm install` to ensure all dependencies are installed
- Check that test files are in the correct locations

**Nodemon crashes:**
- Check the error message in the console
- Ensure all dependencies are installed: `pnpm install`
- Check that `.env` file exists (or create from `.env.example`)
- Verify no syntax errors in server.js or route files

## License

Part of the Ralph project.
